@model IOrderedEnumerable<IGrouping<string, core2Bowling.Models.TeamMember>>

@{
    ViewData["Title"] = "Index";
    var game = (Game)ViewData["Game"];
    var gameNum = game.SubGames.Max(s => s.Round);
}
<h2>Index</h2>

<p>
    <a asp-action="CreateTeam" asp-route-id="@game.ID">Create New</a>

</p>
<div>
    @game.Playtime @game.GameKind

</div>


<table class="table">
    <thead>
        <tr class="text-center">
            <th>팀</th>
            <th>선수</th>
            @for (int i = 0; i < gameNum; i++)
            {
                <th>
                    @(i + 1)  게임
                </th>
            }
            <th>합계</th>
            <th>평균</th>
            <th>에버</th>
            <th>에버 평균</th>
            <th>벌금</th>

        </tr>
    </thead>
    <tbody>
        @{
            int totalFine = 0;
        }
        @foreach (var item in Model)
        {
            int cnt = 1;
            int total = 0;
            int perCnt = 1;
            int fine = 0;

            var team = item.SelectMany(s => s.Team.TeamName).Distinct();
            var avg = item.First().Bowler.BowlerAverage.Average;
            var handi = item.First().Bowler.BowlerAverage.Handicap;

            @:<tr>


                foreach (var bw in item)
                {
                    string classText = string.Empty;
                    if (bw.Score < avg)
                    {
                        classText = "text-primary";
                        fine++;
                    }
                    if (bw.Score > 199)
                    {

                        classText = "text-danger";
                    }

                    if (cnt == 1)
                    {
                        <td>
                            @foreach (var t in team)
                            {
                                @(t + " ");
                            }
                        </td>
                        <td class="@(handi>0?"text-warning":"")">
                            @Html.DisplayFor(modelItem => bw.Bowler.Name)
                        @handi
                    </td>

                }

                if (bw.Team.SubGame.Round == cnt)
                {
                    <td class="@classText">
                        @Html.DisplayFor(modelItem => bw.Score)
                    </td>

                }
                else
                {
                    for (int i = cnt; i < bw.Team.SubGame.Round; i++)
                    {
                        <td>/</td>

                        cnt++;
                    }

                    <td class="@classText">
                        @Html.DisplayFor(modelItem => bw.Score)
                    </td>



                }
                cnt++;
                total += bw.Score;


                @if (cnt > gameNum)
                {

                    <td>@total</td>
                    <td>@(total / perCnt)</td>
                    <td>@avg</td>
                    <td>@((total / perCnt) - avg)</td>
                    <td>@string.Format("{0:n0}", (fine * 1000))</td>
                    @:</tr>
                    totalFine = totalFine + fine;
                }

                //위치 중요
                perCnt++;

            }

        }

    </tbody>
</table>

벌금 :  @string.Format("{0:n0}", (totalFine * 1000))
